set shell := ["bash", "-c"]

add-repos:
    #!/bin/bash
    dnf install -y dnf5-plugins dnf-plugins-core copr-cli
    dnf install -y https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-42.noarch.rpm
    dnf install -y https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-42.noarch.rpm
    dnf config-manager addrepo --from-repofile=https://github.com/terrapkg/subatomic-repos/raw/main/terra.repo
    dnf install terra-release -y
    dnf config-manager addrepo --from-repofile=https://cli.github.com/packages/rpm/gh-cli.repo
    # ACT local gihub actions
    dnf -y copr enable goncalossilva/act
    rpm --import https://packages.microsoft.com/keys/microsoft.asc
    echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\nautorefresh=1\ntype=rpm-md\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" | tee /etc/yum.repos.d/vscode.repo > /dev/null
    dnf config-manager addrepo --from-repofile=https://pkgs.tailscale.com/stable/fedora/tailscale.repo
    cat <<EOF > /etc/yum.repos.d/adoptium.repo
    [Adoptium]
    name=Adoptium
    baseurl=https://packages.adoptium.net/artifactory/rpm/fedora/42/$(uname -m)
    enabled=1
    gpgcheck=1
    gpgkey=https://packages.adoptium.net/artifactory/api/gpg/key/public
    EOF
    copr enable -y scottames/ghostty
    dnf check

install-ansible:
    dnf5 install -y \
        ansible \
        python3-ansible-lint \
        ansible-core-doc \
        ansible-bender \
        ansible-builder \
        ansible-collection-ansible-netcommon \
        ansible-collection-ansible-netcommon-doc \
        ansible-collection-ansible-posix \
        ansible-collection-ansible-utils \
        ansible-collection-community-crypto \
        ansible-collection-community-docker \
        ansible-collection-community-general \
        ansible-collection-community-kubernetes \
        ansible-collection-community-mysql \
        ansible-collection-community-postgresql \
        ansible-collection-community-rabbitmq \
        ansible-collection-containers-podman \
        ansible-collection-kubernetes-core \
        ansible-collection-community-libvirt

install-java:
    dnf5 install -y \
    java-21-openjdk

install-kde-utils:
    dnf5 install -y \
        kmail \
        merkuro \
        konsole \
        plasma-discover-flatpak \
        plasma-discover-rpm-ostree \
        yakuake \
        qt6-qtlocation

install-misc-tools:
    dnf5 install -y \
        waypipe \
        tailscale \
        zsh \
        input-leap \
        rclone \
        mpv \
        borgmatic \
        sqlite-devel \
        ghostty

install-linux-surface:
    dnf config-manager \
    addrepo --from-repofile=https://pkg.surfacelinux.com/fedora/linux-surface.repo
    dnf install --allowerasing -y kernel-surface iptsd libwacom-surface
    dnf install -y surface-secureboot
    # rpm-ostree override replace \
    #     --remove kernel-core \
    #     --remove kernel-modules \
    #     --remove kernel-modules-extra \
    #     --remove libwacom \
    #     --remove libwacom-data \
    #     --install kernel-surface \
    #     --install iptsd \
    #     --install libwacom-surface \
    #     --install libwacom-surface-data

install-kde-plasma:
    dnf groupinstall -y "KDE Plasma Workspaces"
    dnf install -y @kde-desktop-environment

install-cosmic-desktop:
    mkdir -p /var/roothome
    dnf install -y @cosmic-desktop-environment
    rm -rv /var/roothome

install-deepin-desktop:
    mkdir -p /var/roothome
    dnf install -y @deepin-desktop-environment
    rm -rv /var/roothome