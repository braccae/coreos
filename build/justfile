set shell := ["bash", "-c"]

get-active-kernel:
	@for d in /usr/lib/modules/*/; do v=$(basename "$d"); if [ -f "${d}vmlinuz" ]; then printf "%s\n" "$v"; exit 0; fi; done; echo "ERROR: no active kernel found" >&2; exit 1

get-active-kernel-base:
	@FULL_VER=$(just get-active-kernel); BASE_VER=$(echo "$FULL_VER" | cut -d- -f1); printf "%s\n" "$BASE_VER"

install-ublue-repos:
    #!/usr/bin/env bash
    dnf5 install -y dnf-plugins-core
    # Terra
    dnf5 config-manager addrepo --from-repofile=https://github.com/terrapkg/subatomic-repos/raw/main/terra.repo
    dnf install terra-release -y
    # Github CLI
    dnf5 config-manager addrepo --from-repofile=https://cli.github.com/packages/rpm/gh-cli.repo
    # ACT local gihub actions
    dnf -y copr enable goncalossilva/act
    # VSCode
    rpm --import https://packages.microsoft.com/keys/microsoft.asc
    # # Tailscale
    # dnf config-manager addrepo --from-repofile=https://pkgs.tailscale.com/stable/fedora/tailscale.repo
    dnf copr enable -y scottames/ghostty

install-ansible:
    dnf install -y \
        ansible \
        python3-ansible-lint \
        ansible-core-doc \
        ansible-bender \
        ansible-builder \
        ansible-collection-ansible-netcommon \
        ansible-collection-ansible-netcommon-doc \
        ansible-collection-ansible-posix \
        ansible-collection-ansible-utils \
        ansible-collection-community-crypto \
        ansible-collection-community-docker \
        ansible-collection-community-general \
        ansible-collection-community-kubernetes \
        ansible-collection-community-mysql \
        ansible-collection-community-postgresql \
        ansible-collection-community-rabbitmq \
        ansible-collection-containers-podman \
        ansible-collection-kubernetes-core \
        ansible-collection-community-libvirt

install-java:
    dnf install -y \
        java-21-openjdk

install-kde-utils:
    dnf install -y \
        kmail \
        merkuro \
        konsole \
        plasma-discover-flatpak \
        plasma-discover-rpm-ostree \
        yakuake \
        qt6-qtlocation \
        chromium-qt6-ui \
        fedora-chromium-config-kde \
        kde-partitionmanager \
        qt6-qtwebsockets \
        qt6-qtwebsockets-devel

install-misc-tools:
    dnf install -y \
        waypipe \
        tailscale \
        zsh \
        input-leap \
        rclone \
        mpv \
        borgmatic \
        sqlite-devel \
        ghostty \
        chromium \
        chromium-headless \
        chromedriver \
        virt-manager

install-game-mode:
    #!/usr/bin/env bash
    dnf copr enable -y rankyn/xivlauncher
    dnf install -y \
        XIVLauncher
    

install-dev-mode:
    dnf install -y \
        code
